<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<style type="text/css">
.verde {
	color: green;
	front-size: 20px;
	padding: 10px;
}

.rosa {
	color: red;
	front-size: 20px;
	padding: 10px;
}

.azul {
	color: blue;
	front-size: 20px;
	padding: 10px;
}

.seleccionada {
	background-color: pink;
}
</style>

<title>Insert title here</title>
<script type="text/javascript" src="jquery-3.3.1.js"></script>

<script type="text/javascript">
	$(document).ready(
			function() {
			
				//1) Cargamos los libros en el body
				$.get("../ListaLibros.jsp?", function(datos){
					
					//alert(datos);
					$("body").append(datos);
					//AÃ±adirmos una tabla al body
					//La tabla se crea en ListaLibros.jsp donde se obtienen los datos
			
				
			
				
				
				//2)Recojemos el Libro de la tr donde se haga click
				$("tr").click(function() {
					
					
					var titulo;
					var autor;
					var paginas;
					
					$(this).find("td").each(function( index ) {
						  console.log( index + ": " + $( this ).text() );
						 
						  switch (index) {
						case 0:
						    titulo = $(this).eq(0).text();
							console.log(index+ ": " +titulo);
							break;

						case 1:
						    autor = $(this).eq(0).text();
						    console.log(index+ ": " +autor);
							break;
							
						case 2:
						    paginas = $(this).eq(0).text();
						    console.log(index+ ": " +paginas);
							break;
						default:
							console.log("index: default")
							break;
						}
						});
						
				
					console.log(titulo+" "+ autor+" "+paginas);
					
				//3)Llamada ajax para obtener los capitulos
			var promesa =$.get("../MostrarCapitulosLibro.jsp?titulo="
						+titulo+"&autor="+autor+"&paginas="+paginas);

					console.log(promesa);
					
					
					//CUANDO LA PROMESA FINALIZA
			promesa.then(function(datos){
							
			
					console.log("llega promesa:",datos);

				
					var datos2 =datos.trim();
					//var datos =JSON.stringify(datos);
					console.log("datos.trim():",datos2);
					
					// datos = JSON.parse(datos[0].trim());
						var datos3 = datos2.split("[");
						var datos4 = datos3[1].split("]");
						console.log("datos3[1]:",datos4[1]);

						datos5 = datos4[0].split("},{");
						console.log("datos5:",datos5);
						
						
           		console.log("datos4[1]:",datos5[1]);
           		
					for (var i = 0; i < datos5.length; i++) {
						$("body")
								.append(
										"<p>" + datos[i].titulo
												+ ", "
												+ datos[i].paginas
												+ "</p>");
					}


			
				
			})
			
					
					
				})
				
				})
				
			})
			
</script>
</head>
<body>


</body>
</html>



							
					
					
		
					

				